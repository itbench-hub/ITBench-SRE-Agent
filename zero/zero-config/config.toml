# Zero Configuration
# This file is copied to workspace/config.toml when running Zero

profile = "sre_support_engineer"

[profiles.sre_support_engineer]
model_provider = "litellm"
model_reasoning_effort = "low"
sandbox_mode = "workspace-write"
approval_policy = "never"

[profiles.sre_support_engineer.sandbox_workspace_write]
writable_roots = []
network_access = true  # Required for ClickHouse and Kubernetes MCP servers

# ============================================================================
# MCP Servers
# ============================================================================

[mcp_servers.offline_incident_analysis]
command = "python"
args = ["-m", "sre_tools.offline_incident_analysis"]

[mcp_servers.offline_incident_analysis.env]
PYTHONPATH = "python"

# ClickHouse MCP Server (Altinity - Go-based via Docker/Podman)
# Using Altinity MCP instead of mcp-clickhouse to avoid dependency conflicts
# with litellm[proxy] (which requires uvicorn<0.32.0 and rich==13.7.1)
[mcp_servers.clickhouse]
command = "podman"
args = [
    "run", "--rm", "-i", "--network=host",
    "ghcr.io/altinity/altinity-mcp:latest",
    "--clickhouse-host", "${CLICKHOUSE_HOST}",
    "--clickhouse-port", "${CLICKHOUSE_PORT}",
    "--clickhouse-username", "${CLICKHOUSE_USER}",
    "--clickhouse-password", "${CLICKHOUSE_PASSWORD}"
]

# Note: ClickHouse credentials are substituted from environment variables
# Set these in your .env file (see .env.tmpl):
#   CLICKHOUSE_HOST (default: localhost)
#   CLICKHOUSE_PORT (default: 8123)
#   CLICKHOUSE_USER (default: default)
#   CLICKHOUSE_PASSWORD (default: empty)
# Database defaults to "default" (override with --clickhouse-database if needed)

# Kubernetes MCP Server (Python-based from containers/kubernetes-mcp-server)
[mcp_servers.kubernetes]
command = "uvx"
args = ["mcp-kubernetes-server"]

[mcp_servers.kubernetes.env]
# Pass through KUBECONFIG from parent environment
# This is populated from .env or shell environment
KUBECONFIG = "${KUBECONFIG}"
# Suppress FastMCP UI banner (causes JSON parsing errors in stdio mode)
FASTMCP_NO_UI = "1"
NO_COLOR = "1"

# Note: Kubernetes MCP inherits KUBECONFIG from environment
# Set KUBECONFIG in your .env file or it defaults to ~/.kube/config

# ============================================================================
# Model Provider - Local LiteLLM Proxy
# ============================================================================
# LiteLLM routes to OpenRouter (o3-mini, claude, gemini, etc.)
# Run: uv run litellm --config config.yaml

[model_providers.litellm]
name = "LiteLLM Proxy"
base_url = "http://localhost:4000"
# env_key = "DUMMY_KEY_NEED_NOT_BE_UPDATED"
wire_api = "chat"
max_output_tokens = 16384
