# Zero Configuration
# This file is copied to workspace/config.toml when running Zero

profile = "sre_support_engineer"

[profiles.sre_support_engineer]
model_provider = "litellm"
model_reasoning_effort = "low"
sandbox_mode = "workspace-write"
approval_policy = "never"

[profiles.sre_support_engineer.sandbox_workspace_write]
writable_roots = []
network_access = true  # Required for ClickHouse and Kubernetes MCP servers

# ============================================================================
# MCP Servers
# ============================================================================

[mcp_servers.offline_incident_analysis]
command = "python"
args = ["-m", "sre_tools.offline_incident_analysis"]

[mcp_servers.offline_incident_analysis.env]
PYTHONPATH = "python"

# ClickHouse MCP Server (Official Python mcp-clickhouse via Docker)
# Running in Docker container to avoid dependency conflicts with litellm[proxy]
# Supports PROXY_PATH for ClickHouse servers behind reverse proxies
# NOTE: Image must be pre-pulled: podman pull docker.io/mcp/clickhouse:latest
[mcp_servers.clickhouse]
command = "podman"
args = [
    "run", "--rm", "-i",
    "-e", "CLICKHOUSE_HOST=${CLICKHOUSE_HOST}",
    "-e", "CLICKHOUSE_PORT=${CLICKHOUSE_PORT}",
    "-e", "CLICKHOUSE_USER=${CLICKHOUSE_USER}",
    "-e", "CLICKHOUSE_PASSWORD=${CLICKHOUSE_PASSWORD}",
    "-e", "CLICKHOUSE_PROXY_PATH=${CLICKHOUSE_PROXY_PATH}",
    "-e", "CLICKHOUSE_SECURE=${CLICKHOUSE_SECURE}",
    "-e", "CLICKHOUSE_VERIFY=${CLICKHOUSE_VERIFY}",
    "docker.io/mcp/clickhouse:latest"
]

# Note: ClickHouse credentials are substituted from environment variables
# Set these in your .env file (see .env.tmpl):
#   CLICKHOUSE_HOST (hostname only, e.g., elb.amazonaws.com)
#   CLICKHOUSE_PORT (default: 8123 or 80 for HTTP)
#   CLICKHOUSE_USER (default: default)
#   CLICKHOUSE_PASSWORD (default: empty)
#   CLICKHOUSE_PROXY_PATH (for reverse proxy paths, e.g., /clickhouse/clickhouse)
#   CLICKHOUSE_SECURE (true/false for HTTPS, default: false)
#   CLICKHOUSE_VERIFY (true/false for SSL verification, default: true)

# Kubernetes MCP Server (Python-based from containers/kubernetes-mcp-server)
[mcp_servers.kubernetes]
command = "uvx"
args = ["mcp-kubernetes-server"]

[mcp_servers.kubernetes.env]
# Pass through KUBECONFIG from parent environment
# This is populated from .env or shell environment
KUBECONFIG = "${KUBECONFIG}"
# Suppress FastMCP UI banner (causes JSON parsing errors in stdio mode)
FASTMCP_NO_UI = "1"
NO_COLOR = "1"

# Note: Kubernetes MCP inherits KUBECONFIG from environment
# Set KUBECONFIG in your .env file or it defaults to ~/.kube/config

# ============================================================================
# Model Provider - Local LiteLLM Proxy
# ============================================================================
# LiteLLM routes to OpenRouter (o3-mini, claude, gemini, etc.)
# Run: uv run litellm --config config.yaml

[model_providers.litellm]
name = "LiteLLM Proxy"
base_url = "http://localhost:4000"
# env_key = "DUMMY_KEY_NEED_NOT_BE_UPDATED"
wire_api = "chat"
max_output_tokens = 16384
